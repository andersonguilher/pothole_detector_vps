<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConservApp AI - Detec√ß√£o Combinada - Documenta√ß√£o</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #1e3a8a;
            border-bottom: 2px solid #bfdbfe;
            padding-bottom: 10px;
        }

        h2 {
            color: #374151;
            border-left: 5px solid #60a5fa;
            padding-left: 10px;
            margin-top: 25px;
        }

        h3 {
            color: #4b5563;
            margin-top: 15px;
        }

        pre {
            background: #e5e7eb;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        code {
            background: #f3f4f6;
            padding: 2px 4px;
            border-radius: 3px;
        }

        ul {
            list-style: disc;
            margin-left: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 0.9em;
        }

        th {
            background-color: #f9fafb;
            color: #1f2937;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ConservApp AI ‚Äì Detec√ß√£o Combinada (FastAPI + YOLOv8)</h1>
        <p>Aplica√ß√£o Python FastAPI para detec√ß√£o de **Buracos e Bueiros** em vias urbanas utilizando uma arquitetura de
            **M√∫ltiplos Modelos YOLOv8** e c√°lculos de engenharia para estimativa de reparo.</p>

        <h2>Arquitetura Geral</h2>
        <pre>
üìÇ detector/
 ‚îú‚îÄ‚îÄ main.py              # Ponto de entrada da aplica√ß√£o (FastAPI) e l√≥gica de detec√ß√£o.
 ‚îú‚îÄ‚îÄ templates/
 ‚îÇ    ‚îî‚îÄ‚îÄ index.html       # Frontend principal para upload e visualiza√ß√£o de resultados.
 ‚îú‚îÄ‚îÄ static/
 ‚îÇ    ‚îî‚îÄ‚îÄ style.css        # Arquivo de estilos CSS (opcional, para customiza√ß√£o visual).
 ‚îî‚îÄ‚îÄ requirements.txt     # Lista de depend√™ncias Python.
</pre>

        <h2>Modelos e Pipeline de Detec√ß√£o (`main.py`)</h2>
        <p>O backend utiliza tr√™s modelos YOLOv8 carregados no in√≠cio, permitindo a detec√ß√£o dual e a escolha entre
            detec√ß√£o por caixa (Box) ou segmenta√ß√£o (Mask).</p>

        <h3>Modelos Utilizados</h3>
        <table>
            <thead>
                <tr>
                    <th>Modelo</th>
                    <th>Arquivo</th>
                    <th>Finalidade</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Buraco (Box)</td>
                    <td><code>buracos_box.pt</code></td>
                    <td>Detec√ß√£o r√°pida (Bounding Box) de buracos.</td>
                </tr>
                <tr>
                    <td>Buraco (M√°scara)</td>
                    <td><code>buracos_seg.pt</code></td>
                    <td>Segmenta√ß√£o precisa para c√°lculo exato de √°rea.</td>
                </tr>
                <tr>
                    <td>Bueiro</td>
                    <td><code>bueiros_det.pt</code></td>
                    <td>Detec√ß√£o e classifica√ß√£o do estado (Bom, Quebrado, Aberto).</td>
                </tr>
            </tbody>
        </table>

        <h3>L√≥gica de Neg√≥cio (F√≠sica)</h3>
        <p>A aplica√ß√£o integra c√°lculos de engenharia civil baseados nas seguintes constantes (definidas no
            <code>main.py</code>):</p>
        <ul>
            <li><code>PIXEL_TO_CM2 = 0.04</code>: Fator de convers√£o para √°rea de pixel.</li>
            <li><code>DENSIDADE_CBUQ_TM3 = 2.4</code>: Densidade do CBUQ em $t/m^3$.</li>
            <li><code>ESPESSURA_CM = 5</code>: Espessura de refer√™ncia para o c√°lculo de massa (5 cm).</li>
        </ul>

        <h3>Resolu√ß√£o de Conflitos (IOU)</h3>
        <p>√â aplicada a l√≥gica de Intersection Over Union (IOU) para garantir a integridade dos dados:</p>
        <ul>
            <li>**Bueiro Danificado vs. Buraco:** Se um buraco se sobrep√µe a um bueiro danificado (Quebrado/Aberto), o
                buraco √© **descartado** para evitar duplicidade, creditando o dano ao bueiro.</li>
            <li>**Bueiro Bom vs. Buraco:** Se um buraco se sobrep√µe a um bueiro Bom, o bueiro √© **descartado**,
                priorizando o dano do asfalto.</li>
        </ul>

        <h2>Interface do Usu√°rio (`index.html`)</h2>
        <p>O frontend permite o controle din√¢mico dos par√¢metros de detec√ß√£o e exibe o relat√≥rio final de forma
            responsiva.</p>

        <h3>Par√¢metros Din√¢micos</h3>
        <ul>
            <li>**Confian√ßa Buraco:** Controla o score m√≠nimo para aceitar detec√ß√µes de buraco.</li>
            <li>**Confian√ßa Bueiro:** Controla o score m√≠nimo para aceitar detec√ß√µes de bueiro.</li>
            <li>**Modo de Detec√ß√£o:** Escolhe entre o modelo `box` ou `mask`.</li>
        </ul>

        <h2>Requisitos de Depend√™ncias</h2>
        <pre>
fastapi
uvicorn
jinja2
python-multipart
ultralytics
opencv-python
numpy
</pre>

        <h2>Execu√ß√£o do Servidor Uvicorn</h2>
        <pre>
uvicorn main:app --host 0.0.0.0 --port 8000
</pre>
        <p>Acess√≠vel em <code>http://127.0.0.1:8000/</code> para a interface web ou
            <code>http://127.0.0.1:8000/docs</code> para a documenta√ß√£o interativa da API.</p>

        <h2>Configura√ß√£o de Proxy Reverso (Nginx)</h2>
        <p>Para produ√ß√£o, use o Nginx para servir a aplica√ß√£o sob o subdiret√≥rio <code>/detector/</code>.</p>
        <pre>
location /detector/ {
    proxy_pass http://127.0.0.1:8000/;  # A barra no final √© importante
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
</pre>

    </div>
</body>

</html>